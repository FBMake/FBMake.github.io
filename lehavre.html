<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr">
    <head>
        <title>Zone VFHN Le Havre</title>
        
        <link rel="stylesheet" href="./CSS/app.css">
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
        <link rel="icon" type="image/svg" href="./src/favicon-32x32.png">
        <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

        <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

        <!-- Load Esri Leaflet from CDN -->
        <script
          src="https://unpkg.com/esri-leaflet@2.3.3/dist/esri-leaflet.js"
          integrity="sha512-cMQ5e58BDuu1pr9BQ/eGRn6HaR6Olh0ofcHFWe5XesdCITVuSBiBZZbhCijBe5ya238f/zMMRYIMIIg1jxv4sQ=="
          crossorigin=""
        ></script>

        <!-- Load Esri Leaflet Geocoder from CDN -->
        <link
          rel="stylesheet"
          href="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.css"
          integrity="sha512-IM3Hs+feyi40yZhDH6kV8vQMg4Fh20s9OzInIIAc4nx7aMYMfo+IenRUekoYsHZqGkREUgx0VvlEsgm7nCDW9g=="
          crossorigin=""
        />
        <script
          src="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.js"
          integrity="sha512-8twnXcrOGP3WfMvjB0jS5pNigFuIWj4ALwWEgxhZ+mxvjF5/FBPVd5uAxqT8dd2kUmTVK9+yQJ4CmTmSg/sXAQ=="
          crossorigin=""
        ></script>

        <!-- Load Easy Button -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
        <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    </head>



    <body onload="initialize()">
      <nav>
        <div class="navHead">
            <H2>VFHN</H2>
            <div class="buttonMenu">
                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                  viewBox="0 0 283.535 283.535" style="enable-background:new 0 0 283.535 283.535;" xml:space="preserve">
                  <g>
                    <path d="M40.687,101.082C18.252,101.082,0,119.333,0,141.768s18.252,40.686,40.687,40.686s40.686-18.251,40.686-40.686
                      S63.121,101.082,40.687,101.082z M40.687,164.453c-12.51,0-22.687-10.177-22.687-22.686s10.177-22.686,22.687-22.686
                      c12.509,0,22.686,10.177,22.686,22.686S53.195,164.453,40.687,164.453z"/>
                    <path d="M141.768,101.082c-22.435,0-40.686,18.251-40.686,40.686s18.251,40.686,40.686,40.686s40.686-18.251,40.686-40.686
                      S164.202,101.082,141.768,101.082z M141.768,164.453c-12.509,0-22.686-10.177-22.686-22.686s10.177-22.686,22.686-22.686
                      s22.686,10.177,22.686,22.686S154.276,164.453,141.768,164.453z"/>
                    <path d="M242.849,101.082c-22.435,0-40.686,18.251-40.686,40.686s18.251,40.686,40.686,40.686s40.687-18.251,40.687-40.686
                      S265.283,101.082,242.849,101.082z M242.849,164.453c-12.509,0-22.686-10.177-22.686-22.686s10.177-22.686,22.686-22.686
                      c12.51,0,22.687,10.177,22.687,22.686S255.358,164.453,242.849,164.453z"/>
                  </g>
                </svg>
              </div>
        </div>
        <ul class="menu">
            <li><a href="index.html">Rouen</a></li><li><a href="lehavre.html">Le Havre</a></li>
        </ul>
      </nav>

        <div id="map"></div>

    </body>
    <script src="JS/main.js"></script>
</html>
<script type="text/javascript">
    function initialize() {
        var map = L.map('map').setView([49.487084, 0.147129], 8); // LIGNE 18

        var osmLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { // LIGNE 20
            attribution: '© OpenStreetMap contributors',
            maxZoom: 19,
            minZoom: 8
        });

        map.addLayer(osmLayer);

        var VFico = L.icon({
            iconUrl: "src/VFIco.png",
            shadowUrl: "src/VFIco-shadow.png",
            iconSize: [37, 37],
            shadowSize:   [76, 29],
            shadowAnchor: [20, 10]
        });

        //search tool

        const searchControl = L.esri.Geocoding.geosearch().addTo(map);

        const results = L.layerGroup().addTo(map);

        let markers = [];

        searchControl.on("results", function (data) {
            markers = [];
            results.clearLayers();

            let centerMarkerLatlng = centerMarker.getLatLng()
            let dataLatLng = data.latlng
            let zoneCheck = chekRadius(centerMarkerLatlng,dataLatLng);

            let popupdata = new L.Popup()

            popupdata.setLatLng(data.latlng)
            popupdata.setContent(zoneCheck)
            
            popupdata.addTo(results)
          });
          
          function chekRadius(cencenterMarkerLatlnger,dataLatLng){
            let result = cencenterMarkerLatlnger.distanceTo(dataLatLng) / 1000
            console.log(result);
            if (result > 0 && result < 10) {
              return "Zone 1"
            }
            if (result >= 10 && result < 20) {
              return "Zone 2"
            }
            if (result >= 20 && result < 30) {
              return "Zone 3"
            }
            if (result >= 30 && result < 40) {
              return "Zone 4"
            }
            if (result >= 40 && result < 50) {
              return "Zone 5"
            }
            if (result >= 50 && result < 60) {
              return "Zone 6"
            }
            if (result >= 60 && result < 70) {
              return "Zone 7"
            }
            if (result >= 70 && result < 80) {
              return "Zone 8"
            }
            if (result >= 80 && result < 90) {
              return "Zone 9"
            }
            if (result >= 90 && result < 100) {
              return "Zone 10"
            }
            if (result >= 100 && result < 110) {
              return "Zone 11"
            }
            if (result >= 110 && result < 120) {
              return "Zone 12"
            }
            if (result >= 120 && result < 130) {
              return "Zone 13"
            }
            if (result >= 130 && result < 140) {
              return "Zone 14"
            }
          }

        //Bp localisation

        L.easyButton('<img src="src/localisation.png">', function(btn, map){
            map.locate({setView: true, maxZoom: 12});
        }).addTo(map);

        //VFHN Marker


        L.marker([49.369900, 1.094159], { icon: VFico }).addTo(map)
    .bindPopup('VHFN Rouen');
        let centerMarker = L.marker([49.487084, 0.147129], { icon: VFico }).addTo(map)
    .bindPopup('VHFN Le Havre');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 130000}).addTo(map).bindPopup('Zone 13');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 120000}).addTo(map).bindPopup('Zone 12');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 110000}).addTo(map).bindPopup('Zone 11');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 100000}).addTo(map).bindPopup('Zone 10');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 90000}).addTo(map).bindPopup('Zone 09');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 80000}).addTo(map).bindPopup('Zone 08');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 70000}).addTo(map).bindPopup('Zone 07');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 60000}).addTo(map).bindPopup('Zone 06');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 50000}).addTo(map).bindPopup('Zone 05');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 40000}).addTo(map).bindPopup('Zone 04');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 30000}).addTo(map).bindPopup('Zone 03');
        L.circle([49.487084, 0.147129], {color: "blue",opacity: 0.2,fillOpacity: 0, radius: 20000}).addTo(map).bindPopup('Zone 02');
        L.circle([49.487084, 0.147129], {color: "#f03",opacity: 0.2,fillOpacity: 0, radius: 10000}).addTo(map).bindPopup('Zone 01');

        //Search

        function onLocationFound(e) {
            var radius = e.accuracy;

            L.marker(e.latlng).addTo(map);


        }
        map.on('locationfound', onLocationFound);

        function onLocationError(e) {
            alert("Vous avez refusé la localisation !");    //e.message
        }

        map.on('locationerror', onLocationError);

    }

</script>
